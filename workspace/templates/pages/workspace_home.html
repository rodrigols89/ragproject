{% extends "base.html" %}
{% load static %}

{% block title %}Workspace{% endblock %}

{% block content %}
    <div class="flex h-screen bg-gray-100">

        <!-- üß± Sidebar -->
        {% include "partials/sidebar.html" with current_page="workspace" %}

        <!-- üíº √Årea principal do Workspace -->
        <main class="flex-1 p-8 overflow-y-auto">

            <!-- Header -->
            <header class="bg-white shadow px-6 py-4">
                <h1 class="text-2xl font-semibold text-gray-800">
                    Bem-vindo, {{ request.user.username }}!
                </h1>
            </header>


            <!-- üß≠ Breadcrumbs -->
            <nav class="text-sm text-gray-600 my-4 flex items-center
                space-x-2">

                {% if current_folder %}

                    {% if breadcrumbs|length > 1 %}
                        {% with prev_folder=breadcrumbs|slice:"-2:-1"|first %}
                            <a href="?folder={{ prev_folder.id }}"
                               class="text-blue-600 hover:underline
                                   breadcrumb-drop"
                               data-folder-id="{{ prev_folder.id }}">
                                ‚Üê Voltar</a>
                        {% endwith %}
                    {% else %}
                        <a href="{% url 'workspace_home' %}"
                           class="text-blue-600 hover:underline
                               breadcrumb-drop"
                           data-folder-id="">‚Üê Voltar √† raiz</a>
                    {% endif %}

                    <span>/</span>

                    <a href="{% url 'workspace_home' %}"
                       class="hover:underline breadcrumb-drop"
                       data-folder-id="">üìÅ Raiz</a>

                    <span>/</span>

                    {% for folder in breadcrumbs %}
                        {% if not forloop.last %}
                            <a href="?folder={{ folder.id }}"
                               class="hover:underline breadcrumb-drop"
                               data-folder-id="{{ folder.id }}">
                                {{ folder.name }}</a>
                            <span>/</span>
                        {% else %}
                            <span class="font-semibold breadcrumb-drop"
                                  data-folder-id="{{ folder.id }}">
                                {{ folder.name }}
                            </span>
                        {% endif %}
                    {% endfor %}

                {% else %}
                    <span class="text-gray-400 italic breadcrumb-drop"
                          data-folder-id="">
                        üìÅ Raiz
                    </span>
                {% endif %}

            </nav> <!-- üß≠ Breadcrumbs -->


            <!-- Mensagens -->
            {% if messages %}
                <ul class="mb-4">
                    {% for message in messages %}
                        <li class="px-4 py-2 rounded 
                            {% if message.tags == 'success' %}
                                bg-green-100 text-green-700
                            {% else %}bg-red-100 text-red-700{% endif %}">
                                {{ message }}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %} <!-- /Mensagens -->















            <!-- üìå Bot√µes -->
            <div class="mb-6 flex items-center gap-3 flex-wrap" data-preserve-selection="true">

                <!-- üìå Bot√£o de Criar Pasta -->
                <button
                    command="show-modal"
                    commandfor="create_folder_modal"
                    class="inline-block
                            bg-green-600
                            hover:bg-green-700
                            text-white
                            px-4
                            py-2
                            rounded">
                    ‚ûï Nova Pasta
                </button> <!-- üìå /Bot√£o de Criar Pasta -->
























                <!-- Dropdown de Upload (Bot√£o de Upload) -->
                <div class="relative inline-block">
                    <button 
                        type="button"
                        id="upload_button"
                        class="
                            inline-block
                            bg-blue-600
                            hover:bg-blue-700
                            text-white
                            px-4
                            py-2
                            rounded
                            cursor-pointer">
                        üì§ Fazer Upload
                    </button>
                    
                    <div
                        id="upload_menu" 
                        class="
                            hidden
                            absolute
                            left-0
                            mt-2
                            w-48
                            bg-white
                            rounded-md
                            shadow-lg
                            z-50
                            border
                            border-gray-200">
                        <div class="py-1">
                            <label
                                for="file_input"
                                class="
                                    block
                                    px-4
                                    py-2
                                    text-sm
                                    text-gray-700
                                    hover:bg-gray-100
                                    cursor-pointer">
                                üìÑ Arquivo
                            </label>
                            <label
                                for="folder_input"
                                class="
                                    block
                                    px-4
                                    py-2
                                    text-sm
                                    text-gray-700
                                    hover:bg-gray-100
                                    cursor-pointer">
                                üìÅ Pasta
                            </label>
                        </div>
                    </div>
                </div> <!-- /Dropdown de Upload (Bot√£o de Upload) -->

                <!-- Formul√°rio para upload de arquivo -->
                <form method="post"
                      id="upload_file_form"
                      action="{% url 'upload_file' %}"
                      enctype="multipart/form-data"
                      class="hidden">

                    {% csrf_token %}

                    <input 
                        type="hidden" 
                        name="next" 
                        value="{{ request.get_full_path }}">
                    <input 
                        type="hidden" 
                        name="folder" 
                        value="{{ current_folder.id|default_if_none:'' }}">
                    <input 
                        type="hidden" 
                        name="upload_type" 
                        value="file">
                    <input 
                        type="file" 
                        name="file" 
                        id="file_input"
                        multiple 
                        class="hidden" 
                        onchange="this.form.submit()">
                </form> <!-- /Formul√°rio para upload de arquivo -->

                <!-- Formul√°rio para upload de pasta -->
                <form method="post"
                      id="upload_folder_form"
                      action=""
                      enctype="multipart/form-data"
                      class="hidden">
                    {% csrf_token %}
                    <input 
                        type="hidden" 
                        name="next" 
                        value="{{ request.get_full_path }}">
                    <input 
                        type="hidden" 
                        name="folder" 
                        value="{{ current_folder.id|default_if_none:'' }}">
                    <input 
                        type="file" 
                        name="files" 
                        id="folder_input"
                        webkitdirectory 
                        directory 
                        multiple 
                        class="hidden" 
                        required>
                    <input 
                        type="hidden" 
                        name="folder_name" 
                        id="detected_folder_name">
                    <input 
                        type="hidden" 
                        name="file_paths" 
                        id="file_paths_json">
                </form> <!-- /Formul√°rio para upload de pasta -->


































            </div> <!-- üìå /Bot√µes -->




















































            <!-- MODAL Criar Pasta -->
            <el-dialog>
                <dialog
                    id="create_folder_modal"
                    aria-labelledby="modal-title"
                    {% if show_modal %}data-auto-open="true"{% endif %}
                    class="
                        fixed
                        inset-0
                        size-auto
                        max-h-none
                        max-w-none
                        overflow-y-auto
                        bg-transparent
                        backdrop:bg-transparent">

                    <el-dialog-backdrop
                        class="
                            fixed
                            inset-0
                            bg-gray-900/50
                            transition-opacity">
                    </el-dialog-backdrop>

                    <div
                        tabindex="0"
                        class="
                            flex
                            min-h-full
                            items-center
                            justify-center
                            p-4
                            text-center
                            sm:p-0">
                        <el-dialog-panel
                            class="
                                relative
                                transform
                                rounded-lg
                                bg-white
                                shadow-xl
                                transition-all
                                sm:w-full
                                sm:max-w-md
                                p-6">
                            <form method="post" action="{% url 'create_folder' %}">
                                {% csrf_token %}
                                <input 
                                    type="hidden" 
                                    name="next" 
                                    value="{{ request.get_full_path }}">
                                <input
                                    type="hidden" 
                                    name="parent" 
                                    value="{{ current_folder.id|default_if_none:'' }}">

                                <h3 id="modal-title" class="text-lg font-semibold text-gray-900 mb-4">
                                    Criar nova pasta
                                </h3>

                                <div>
                                    <label
                                        for="folder_name"
                                        class="
                                            block
                                            text-sm
                                            font-medium
                                            text-gray-700">
                                        Nome da pasta
                                    </label>
                                    <input
                                        type="text"
                                        name="name"
                                        id="folder_name"
                                        required
                                        class="
                                            mt-1 block
                                            w-full
                                            px-4
                                            py-2
                                            border
                                            rounded-lg"
                                        autocomplete="off"
                                        value="{{ form.name.value|default:'' }}">

                                    {% if form.name.errors %}
                                        <p
                                            id="server-error"
                                            class="
                                                text-sm
                                                text-red-500
                                                mt-1"
                                        >
                                            {{ form.name.errors.0 }}
                                        </p>
                                    {% else %}
                                        <p
                                            id="server-error"
                                            class="
                                                text-sm
                                                text-red-500
                                                mt-1
                                                hidden"
                                        ></p>
                                    {% endif %}
                                </div>

                                <div class="mt-6 flex justify-end space-x-2">

                                    <button
                                        type="submit"
                                        id="create_folder_btn"
                                        class="
                                            px-4
                                            py-2
                                            bg-green-600
                                            hover:bg-green-700
                                            text-white
                                            rounded">
                                        Criar
                                    </button>

                                    <button
                                        type="button"
                                        command="close"
                                        commandfor="create_folder_modal"
                                        class="
                                            px-4
                                            py-2
                                            bg-gray-200
                                            hover:bg-gray-300
                                            rounded">
                                        Cancelar
                                    </button>
                                </div>
                            </form>
                        </el-dialog-panel>
                    </div>
                </dialog>

            </el-dialog> <!-- MODAL Criar Pasta -->




































































            <!-- üìÅ Listagem de pastas e arquivos -->
            {% if folders or files %}

                <ul class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">

                    <!-- Pastas -->
                    {% for folder in folders %}
                        <li class="
                                bg-white
                                border
                                rounded-lg
                                p-4
                                cursor-pointer
                                transition
                                transform
                                hover:scale-102
                                hover:bg-gray-200
                                selectable-item"
                            data-url="?folder={{ folder.id }}"
                            data-target="_self"
                            data-kind="folder"
                            data-id="{{ folder.id }}"
                            draggable="true">
                                <div class="block">
                                    <span class="text-gray-800
                                                font-semibold flex
                                                items-center space-x-2">
                                        <span>üìÅ</span>
                                        <span>{{ folder.name }}</span>
                                    </span>
                                </div>
                        </li>
                    {% endfor %}

                    <!-- Arquivos -->
                    {% for file in files %}
                        <li class="
                                bg-white
                                border
                                rounded-lg
                                p-4
                                cursor-pointer
                                transition
                                transform
                                hover:scale-102
                                hover:bg-gray-200
                                selectable-item"
                            data-url="{{ file.file.url }}"
                            data-target="_blank"
                            data-kind="file" data-id="{{ file.id }}"
                            draggable="true">
                                <div class="block">
                                    <span class="
                                                text-gray-800
                                                font-semibold
                                                flex items-center
                                                space-x-2">
                                        <span>üìÑ</span>
                                        <span>{{ file.name }}</span>
                                    </span>
                                </div>
                        </li>
                    {% endfor %}

                </ul>
            {% else %}
                <p class="pt-4 text-gray-500 italic">
                    Nenhum item encontrado neste diret√≥rio.
                </p>
            {% endif %} <!-- üìÅ /Listagem de pastas e arquivos -->































































        </main>
    </div>
{% endblock %}
{% block scripts %}
    <script src="{% static 'workspace/js/workspace_home.js' %}"></script>
{% endblock scripts %}
